---
sidebar_label: 上位机通信协议
sidebar_position: 2
---

# 上位机通信协议

| 版本 |	变更内容	 |编写人 | 	日期|
| :-| :- | :- | :- |
|V1.0|	First Release	|刘全武	|2022.5|

## 概述
CSK通过UART与上位机完成相关数据通信，包括图像数据、骨骼点数据、运行状态等。此文档用于说明UART通信的数据内容和协议格式。

## 坐姿串口协议

### 一、传输协议
传输协议，是以接收到的 UART 原始数据为基础，定义 CSK 数据帧格式，对流式的二进制数据，进 行分帧工作，解析出对应的帧信息，向上传递到业务协议层。传输协议的数据帧格式如下：

| 帧头     |       |        |       |      |      | 帧数据 |      |      |      |      |
| -------- | ----- | ------ | ----- | ---- | ---- | ------ | ---- | ---- | ---- | ---- |
| 固定标记 |       | 帧长度 |       |      |      |        |      |      |      |      |
| FTAGL    | FTAGH | FLENL  | FLENH | FUID | LCHK | TYPE   | DATA | DCHK |      |      |



#### 1.1 帧头说明 

| 名称     | 长度(byte) | 说明                                                         |
| -------- | ---------- | ------------------------------------------------------------ |
| 固定标记 | 2          | 固定为 FTAGL = 0xAA，FTAGH = 0xBB。                          |
| 帧长度   | 2          | 由两个字节组成，低字节在前，高字节在后；表示整个帧的长度。   |
| 帧序号   | 1          | 表示命令帧的序号，确保短时唯一。                             |
| 帧头校验 | 1          | 采用按字节累加和校验；即： （FTAGL + FTAGH + FLENL + FLENH + FUID + LCHK）% 256 = 0 |



#### 1.2 帧数据说明



| 名称       | 长度(byte) | 说明                                                         |
| ---------- | ---------- | ------------------------------------------------------------ |
| 类型       | 1          | 0x1：身体趴桌 。 0x2：身体倾斜。  0x3：左手撑脸。 0x4： 右手撑脸。  0x5：双手撑脸。  0x6：双手下垂。 0x7：手腕搭桌   0x8：左手搭桌。 0x9：右手搭桌。 0xA：骨骼点。 0xB：人物框。0xFF:图像数据 |
| 数据       | NG         | 由一系列用户数据组成，如骨骼点,人物框,图像                   |
| 帧数据校验 | 1          | 采用按字节累加和校验；即： （TYPE + DATA+ LCHK）% 256 = 0    |
|            |            |                                                              |



#### 1.2 不同类型帧数据说明

##### 1.2.1 骨骼点



| 点数 | 分数 | 第1点X | 第1点Y | 第2点X | 第2点Y | ...  |
| ---- | ---- | ------ | ------ | ------ | ------ | ---- |



| 名称     | 长度(byte) | 说明           |
| -------- | ---------- | -------------- |
| 点数     | 1          | 点数，一般为11 |
| 分数     | 4          | 分数           |
| 第1点X   | 4          | 第1个点的X值   |
| 第1点Y   | 4          | 第1个点的Y值   |
| 第n..点X | 4          | 第n..个点的X值 |
| 第n..点Y | 4          | 第n..个点的Y值 |

##### 1.2.2 人物框



| 框数 | 分数 | 第1个框X | 第1个框Y | 第1个框W | 第1个框H | ...  |
| ---- | ---- | -------- | -------- | -------- | -------- | ---- |



| 名称     | 长度(byte) | 说明          |
| -------- | ---------- | ------------- |
| 框数     | 1          | 框数，一般为1 |
| 分数     | 4          | 框的分数      |
| 第1个框X | 4          | 第1个点的X值  |
| 第1个框Y | 4          | 第1个点的X值  |
| 第1个框W | 4          | 第1点W值      |
| 第1个框H | 4          | 第1点H值      |

##### 1.2.3 图像



| 属性 | 数据 |      |      |      |      | ...  |
| ---- | ---- | ---- | ---- | ---- | ---- | ---- |



| 名称 | 长度(byte) | 说明  |
| ---- | ---------- | ----- |
| 属性 | 1          | 1:RGB |
| 长   | 2          |       |
| 宽   | 2          |       |
| 数据 |            |       |
|      |            |       |
|      |            |       |



### 二、示例

#### 2.1身体趴桌

| FTAGL | FTAGH | FLENL | FLENH | FUID | LCHK | TYPE | DATA | DCHK |      |      |
| ----- | ----- | ----- | ----- | ---- | ---- | ---- | ---- | ---- | ---- | ---- |
| AA    | AB    | 01    | 00    | 01   | 99   | 01   |      | FF   |      |      |
|       |       |       |       |      |      |      |      |      |      |      |



#### 2.2骨骼点

##### 2.2.1帧头

| FTAGL | FTAGH | FLENL | FLENH | FUID | LCHK | TYPE | DATA | DCHK |      |      |
| ----- | ----- | ----- | ----- | ---- | ---- | ---- | ---- | ---- | ---- | ---- |
| AA    | AB    | 01    | 00    | 01   | 99   | 0A   |      |      |      |      |
|       |       |       |       |      |      |      |      |      |      |      |



##### 2.2.2帧数据

| 点数 | 第1点分数   | 第1点X      | 第1点Y      | 第2点X    | 第2点Y     | DCHK |      |      |      |      |
| ---- | ----------- | ----------- | ----------- | --------- | ---------- | ---- | ---- | ---- | ---- | ---- |
| 1    | 00 01 00 00 | 00 01 00 00 | 00 01 00 00 | 00 001 00 | 00 001  00 | FB   |      |      |      |      |
|      |             |             |             |           |            |      |      |      |      |      |

